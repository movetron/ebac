(()=>{"use strict";let e=!1;setTimeout((()=>{if(e){let e=new Event("windowScroll");window.addEventListener("scroll",(function(t){document.dispatchEvent(e)}))}}),0);const t=()=>{const e=new DataTransfer,t=document.querySelector(".block-files__error-message"),n=document.querySelector(".block-files__list"),a=document.querySelector("form");function o(e,t){e.setAttribute("draggable","true"),e.addEventListener("dragstart",(e=>{e.dataTransfer.setData("text/plain",t),e.target.classList.add("dragging")})),e.addEventListener("dragover",(e=>e.preventDefault())),e.addEventListener("drop",(e=>{e.preventDefault();!function(e,t){const n=document.querySelector(".block-files__list"),a=Array.from(n.children),o=a[e];e!==t&&n.insertBefore(o,a[t>e?t+1:t])}(e.dataTransfer.getData("text/plain"),t)})),e.addEventListener("dragend",(()=>{document.querySelectorAll(".dragging").forEach((e=>e.classList.remove("dragging")))}))}let i=document.getElementById("drop-area");function r(e){e.preventDefault(),e.stopPropagation()}function s(){i.classList.add("highlight")}function l(){i.classList.remove("highlight")}function d(t,a){const i=document.querySelectorAll(".block-files__item");if(!Array.from(i).map((e=>e.querySelector(".block-files__list-name").textContent)).includes(`Название: ${t.name}`)){const i=document.createElement("div");i.className="block-files__item",i.draggable=!0;const r=document.createElement("img");r.className="block-files__list-img",r.src=a;const s=document.createElement("span");s.className="block-files__list-name",s.textContent=`Название: ${t.name}`;const l=document.createElement("span");l.className="block-files__list-type",l.textContent=`Формат: ${t.type}`;const d=document.createElement("span");d.className="block-files__list-size",d.textContent=`Размер: ${(t.size/1048576).toFixed(2)} МБ`;const c=document.createElement("a");c.href="#",c.className="block-files__list-remove",c.onclick=function(n){n.preventDefault(),function(t,n){t.closest(".block-files__item").remove();for(let t=0;t<e.items.length;t++)if(n===e.items[t].getAsFile().name){e.items.remove(t);break}m()}(c,t.name)},i.appendChild(r),i.appendChild(s),i.appendChild(l),i.appendChild(d),i.appendChild(c),n.appendChild(i),o(i,n.children.length-1)}}function c(e){Array.from(e).forEach((e=>{const t=new FileReader;t.readAsDataURL(e),t.onloadend=function(){d(e,t.result)}}))}function m(){const t=new DataTransfer;Array.from(e.files).forEach((e=>t.items.add(e))),document.querySelector(".block-files__form input[type=file]").files=t.files}["dragenter","dragover","dragleave","drop"].forEach((e=>{i.addEventListener(e,r,!1)})),i.addEventListener("drop",(function(t){t.preventDefault();let n=t.dataTransfer.files;const a=new DataTransfer;Array.from(e.files).forEach((e=>a.items.add(e))),Array.from(n).forEach((t=>{Array.from(e.files).some((e=>e.name===t.name))||a.items.add(t)})),e.items.clear(),Array.from(a.files).forEach((t=>e.items.add(t))),document.querySelector('input[type="file"]').files=e.files,c(n)}),!1),["dragenter","dragover"].forEach((e=>{i.addEventListener(e,s,!1)})),["dragleave","drop"].forEach((e=>{i.addEventListener(e,l,!1)})),document.querySelector(".block-files__form input[type=file]").addEventListener("change",(function(){t.innerHTML="",t.style.display="none";const o=Array.from(this.files),i=Array.from(e.files).map((e=>e.name));let r=e.files.length;o.forEach((n=>{if(r>=5)return t.textContent="Превышено допустимое количество файлов: 5",void(t.style.display="block");if(i.includes(n.name))return t.textContent=`Файл ${n.name} уже добавлен`,void(t.style.display="block");return["image/jpeg","image/png","image/jpg"].includes(n.type)?n.size>10485760?(t.textContent=`Превышен максимальный размер файла: ${n.name}`,void(t.style.display="block")):(e.items.add(n),r++,i.push(n.name),void m()):(t.textContent=`Неверный формат файла: ${n.type}`,void(t.style.display="block"))})),c(o),a.addEventListener("submit",(t=>{t.preventDefault(),e.items.clear(),n.innerHTML="",m()}))}))},n=()=>{const e=document.querySelector("form"),t=document.querySelector("#block-files__input"),n=document.querySelector(".block-files__list"),a="Загрузка",o="Спасибо! Скоро мы с вами свяжемся",i="Что-то пошло не так...",r="img/ok.png",s="img/fail.png",l=()=>{t.value="",n.innerHTML=""};let d=1;e.addEventListener("submit",(t=>{t.preventDefault();let c=document.createElement("div");c.classList.add("status"),n.parentNode.appendChild(c);let m=document.createElement("div");m.classList.add("spinner"),c.appendChild(m);let f=document.createElement("img");f.classList.add("animated","fadeInUp"),c.appendChild(f);let u=document.createElement("div");u.textContent=a,c.appendChild(u);const p=new FormData(e),g={};for(let[e,t]of p.entries())t instanceof File?(g[`file${d}`]={name:t.name,size:t.size,type:t.type},d++):g[e]=t;(async(e,t)=>{const n=await fetch(e,{method:"POST",headers:{"Content-type":"application/json"},body:t});return await n.json()})("https://jsonplaceholder.typicode.com/posts",JSON.stringify(g)).then((e=>{console.log(e)})).catch((()=>{f.setAttribute("src",s),u.textContent=i})).finally((()=>{l(),setTimeout((()=>{m.classList.remove("spinner"),f.setAttribute("src",r),u.textContent=o,l(),setTimeout((()=>{c.remove()}),2e3)}),3e3)})),n.innerHTML=""}))};window.addEventListener("DOMContentLoaded",(()=>{t(),n()})),window.FLS=!0,function(e){let t=new Image;t.onload=t.onerror=function(){e(2==t.height)},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}((function(e){let t=!0===e?"webp":"no-webp";document.documentElement.classList.add(t)}))})();